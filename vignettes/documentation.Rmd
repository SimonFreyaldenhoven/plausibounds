---
title: "Introduction to plausibounds: Computing Plausible Bounds for dynamic effect plots"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to plausibounds}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---




``` r
library(plausibounds)
library(ggplot2)
```
## Dynamic Effect Plots

To understand the dynamic effects of a policy, it is common to summarize estimated effects over time in a dynamic effect (or event-study) plot. For example, a macroeconomist may estimate the response of the Consumer Price Index to a monetary shock via local projections, or a microeconomist may estimate the response of labor market outcomes to a change in welfare policies via distributed lag models.

## Overview

The `plausibounds` package provides simple additions to standard visualizations of dynamic treatment effects aimed at enhancing their informativeness. In particular, it provides functionality to:

* include joint hypothesis tests and summary measures that are often of direct interest alongside the standard event-study plot.

* compute a smooth approximation to the treatment-effect path from a prespecified, economically motivated class and produces corresponding confidence regions. The resulting intervals can be substantially tighter than conventional uniform bands while maintaining formal coverage guarantees through post-selection inference (Berk et al. [2013]).

## Background

We write $\theta=(\beta^{pre'},\beta')'$ for the $p \times 1$ vector that collects the elements of the dynamic treatment effect path depicted on the dynamic effect plot. Here, $\beta_{pre} = \{\beta^{pre}_h\}_{h={-L}}^{-1}$ denotes the displayed pre-event effects, $\beta=\{\beta_h\}_{h={1}}^{H}$ collects the dynamic treatment effect path after the event up to the fixed maximum horizon of interest $H$, and thus $p = H+L$. We assume access to point estimates of the parameters $\theta_h$, denoted by $\hat{\theta}_h$, that correspond to the cumulative effect of the policy at horizon $h$ relative to period 0. Throughout, we assume the vector that collects the estimated dynamic treatment effect path, $\hat\theta$, satisfies $\hat\theta \sim N(\theta,V_{\theta})$ and that we have access to the covariance matrix $V_{\theta}$. Leading examples to obtain such estimates include distributed lag models, local projections, and event studies.

The package takes $\theta$ and $V_{\theta}$ as input.

### Finding the surrogate path

The main contribution is to include new visual elements meant to depict approximations to the underlying effect path constrained to exhibit economically and statistically plausible shapes. Intuitively, these elements formalize "visual data snooping": Our proposal approximates looking at a dynamic effect plot and then choosing a specification that "captures the main dynamics" while a) providing a notion of valid inference that explicitly accounts for the data-dependent choice of specification and b) using the full covariance structure of the estimates when choosing the specification.

Specifically, we construct *restricted estimates* and *plausible bounds* by using data-driven regularization to select an approximation to the treatment path from a pre-specified class. We consider a default universe motivated by a preference for smooth dynamics that eventually die out. The restricted estimates are the resulting regularized point estimates of the treatment path. Our plausible bounds are sup-t bands under the selected approximation, adjusted to account for data-dependent selection using Berk et al.'s [2014] post-selection inference (PoSI).

Intuitively, the plausible bounds represent a compromise between inference under no restrictions --- which may yield very wide confidence intervals --- and inference based on a single, prespecified model that does not adapt to the data and may therefore be overly restrictive.


## Basic Usage

Let's start by examining the structure of the example datasets included in the package:


``` r
# Load example datasets
data(estimates_smooth)
data(var_smooth)

# Examine the data structures
print(estimates_smooth)
#>  [1] -0.17482676 -0.02004318 -0.10031844  0.07229334 -0.31769306  0.01454694  0.06322594 -0.04186633  0.12340034 -0.04534908
#> [11] -0.16169097 -0.20259667 -0.03298893 -0.02878808 -0.11865547 -0.33781817 -0.04988252 -0.23286451 -0.34721788 -0.31989801
#> [21] -0.37015145 -0.18439333 -0.08283743 -0.06628430  0.07793498 -0.16041782  0.08020676 -0.26365956 -0.09156697 -0.08646877
#> [31]  0.17552747 -0.26331948  0.26817909  0.21390666  0.02886865 -0.03854033 -0.17947818 -0.04629705 -0.26782818  0.03586062
#> [41]  0.17248994 -0.01214121 -0.08781408  0.12013731
print(var_smooth)
#>             [,1]       [,2]       [,3]       [,4]       [,5]       [,6]       [,7]       [,8]      [,9]     [,10]     [,11]
#>  [1,] 0.01981023 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>  [2,] 0.00000000 0.01981023 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>  [3,] 0.00000000 0.00000000 0.01981023 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>  [4,] 0.00000000 0.00000000 0.00000000 0.01981023 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>  [5,] 0.00000000 0.00000000 0.00000000 0.00000000 0.01981023 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>  [6,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.01981023 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>  [7,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.01981023 0.00000000 0.0000000 0.0000000 0.0000000
#>  [8,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.01981023 0.0000000 0.0000000 0.0000000
#>  [9,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0142814 0.0000000 0.0000000
#> [10,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0145656 0.0000000
#> [11,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0148526
#> [12,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [13,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [14,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [15,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [16,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [17,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [18,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [19,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [20,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [21,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#> [22,] 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.00000000 0.0000000 0.0000000 0.0000000
#>           [,12]    [,13]     [,14]     [,15]     [,16]     [,17]   [,18]     [,19]     [,20]     [,21]     [,22]    [,23]
#>  [1,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [2,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [3,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [4,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [5,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [6,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [7,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [8,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#>  [9,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [10,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [11,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [12,] 0.0151424 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [13,] 0.0000000 0.015435 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [14,] 0.0000000 0.000000 0.0157304 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [15,] 0.0000000 0.000000 0.0000000 0.0160286 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [16,] 0.0000000 0.000000 0.0000000 0.0000000 0.0163296 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [17,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0166334 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [18,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.01694 0.0000000 0.0000000 0.0000000 0.0000000 0.000000
#> [19,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0172494 0.0000000 0.0000000 0.0000000 0.000000
#> [20,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0175616 0.0000000 0.0000000 0.000000
#> [21,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0178766 0.0000000 0.000000
#> [22,] 0.0000000 0.000000 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0181944 0.000000
#>           [,24]     [,25]     [,26]     [,27]   [,28]     [,29]     [,30]     [,31]     [,32]    [,33]     [,34]     [,35]
#>  [1,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [2,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [3,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [4,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [5,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [6,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [7,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [8,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>  [9,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [10,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [11,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [12,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [13,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [14,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [15,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [16,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [17,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [18,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [19,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [20,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [21,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#> [22,] 0.0000000 0.0000000 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000 0.0000000
#>           [,36]     [,37]   [,38]     [,39]     [,40]     [,41]     [,42]    [,43]     [,44]
#>  [1,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [2,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [3,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [4,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [5,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [6,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [7,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [8,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [9,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [10,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [11,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [12,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [13,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [14,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [15,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [16,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [17,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [18,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [19,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [20,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [21,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#> [22,] 0.0000000 0.0000000 0.00000 0.0000000 0.0000000 0.0000000 0.0000000 0.000000 0.0000000
#>  [ reached 'max' / getOption("max.print") -- omitted 22 rows ]
```

The `estimates_smooth` vector contains 36 treatment effect estimates at different horizons and 8 preperiods. The `var_smooth` matrix is a diagonal variance-covariance matrix with no correlation between periods.

### Example 1: Independent Errors

The simplest case uses the `plausible_bounds()` function with just the estimates and variance-covariance matrix. The `alpha` parameter controls the confidence level (default is 0.05 for 95% confidence):





















